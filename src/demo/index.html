<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSR Demo</title>
    <script src="websr.js" type="application/javascript"></script>
</head>
<body style="background: gray;">

<img id="img" src="test.png" height="512" width="512"  />
<canvas id="canvas" width="256" height="256" style="display: none;"></canvas>
<canvas id="canvas2" width="512" height="512"></canvas>
<img id="ref" src="tf-pred.png" height="512" width="512"  />

<script>

    const workingCanvas = document.getElementById('canvas');
    const destinationCanvas = document.getElementById('canvas2')


    WebSR.initWebGPU().then(async function (gpu) {

        if(!gpu) return console.log("Unable to load WebGPU");

        const weights = await (await fetch('./anime4k-cnn-2x-s-debug.json')).json()

        const websr = new WebSR("anime4k/cnn-2x-s", weights,  gpu, workingCanvas, destinationCanvas);

        console.log("Loaded WebSR", websr);

        const bitmap = await createImageBitmap(document.getElementById('img'));

        console.log("Feeding bitmap into WebSR");

        await websr.loadImage(bitmap);

        console.log("Rendering");

        await websr.render();



        console.log("Loading debug weights");
        const debug_weights = await (await fetch('./anime4k-cnn-2x-s-debug-weights.json')).json()

        debug_weights.output = debug_weights.final;

        delete debug_weights.final;

        console.log("Debug weights");
        console.log(debug_weights);




    });


</script>


</body>
</html>